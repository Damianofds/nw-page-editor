#!/bin/bash

[ "${nw_page_editor:-}" = "" ] &&
  nw_page_editor=$(readlink -f "$0" | sed "s|/bin/${0##*/}$||");

if [ $( uname | grep -ci darwin ) != 0 ]; then
  nw="/Applications/nwjs.app/Contents/MacOS/nwjs";
  [ ! -f "$nw" ] &&
    nw=$(mdfind nwjs.app | head -n 1)"Contents/MacOS/nwjs";
else
  nw=$(which nw);
fi

[ ! -f "$nw_page_editor/js/nw-app.js" ] &&
  echo "${0##*/}: error: unable to resolve the nw-page-editor app location" 1>&2 &&
  exit 1;
[ ! -f "$nw" ] &&
  echo "${0##*/}: error: unable find the NW.js binary in the PATH" 1>&2 &&
  exit 1;

files=();

n="1";
while [ $n -le $# ]; do
  if [ ! -e "${!n}" ]; then
    echo "${0##*/}: warning: skipping non-existing file: ${!n}" 1>&2;
  else
    files+=( $(realpath -s "${!n}") );
  fi
  n=$((n+1));
done

"$nw" "$nw_page_editor" "${files[@]}";
